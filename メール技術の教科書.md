- メールは手紙と似ている。
    - 電話みたいに送信者と受信者で時間を合わせなくて良い。
    - 手紙は受信者に送るのに時間がかかる。メールの方が早い。
    - メールの方がコストが安価。手紙は切手代がかかる。

- メールの基本的な仕組み。
    - メールを送るにはメールサーバが必要。
    - 送信と受信でそれぞれサーバが必要。
    - 送信者と受信者でプロトコルというルールが必要。
    - 送信者は`SMTP`、受信者は`POP`と`IMAP`
    - プロトコルを実現するためのソフトウェアがある。SMTPならSMTPサーバ、POPならPOPサーバ、IMAPならIMAPサーバ。
    - POPは受信者がメールを受信するとサーバからメールは消える。一度端末でメールを見ると他の端末からはメールを見れない。現代ではあまり使用していないのでは。
    - 一方、IMAPはメールサーバからメールを見てもサーバからメールは消えない。容量を気にしなければいけないが、どの端末からでもネットで繋げればメールの中身を見れる。Gmailやhotmail、Yahooメールなどが該当する。
    - メールを送る際には複数のメールサーバを経由して、受信者にメールが届いている。
    - メールサーバに接続する際にはメールソフトをパソコンにインストールする方法やブラウザからメールソフトにアクセスする方法がある。後者はGmailが代表的。
    - メールソフトからメールを書いて、送信ボタンを押すと送信用のメールサーバにメールが届く。そして、メールアドレスのドメインをDNSに問い合わせて、受信側のメールサーバまでメールが届くまで送信する。受信側のメールサーバにメールが届いたら、メールが受信ボックスに保存され、メールソフトでサーバに接続する。

    - 通信相手を識別する
        - IPアドレスを使用する。IPv4（32桁の2進数）が枯渇してきているため、以下を使用する。
            - グローバルIPアドレス。
                - ネットワーク上で一意である必要がある。組織を一意に識別するために使用する。
            - ローカルIPアドレス。
                - 組織内で一意である必要がある。別の組織と同じIPを使用してもオッケー。
        - グローバルIPアドレスで組織を一意に識別して、組織内をローカルIPアドレスで一意に識別する。
        - 上記を行ってもIPアドレスが枯渇するため、IPv6（128桁の2進数）が出現している。

        - ホスト名とIPアドレスの紐付け表みたいなものを管理しているのがDNSサーバ。電話帳みたいなもの。DNSは階層構造でホスト名を管理している。jpの下にco、その下にshoeiみたいな。責任範囲を明確化している。会社の組織みたいにトップに社長、下に副社長、事業部長、部長、課長みたいに。

    - SMTP通信
        - メールソフトとメールサーバの間でSMTPコマンドとSMTPレスポンスコードをやりとりしている。SMTPコマンドでメールの送信者や受信者、メール本文などの情報をSMTPコマンドでサーバ側に送信している。そのコマンドが正常に行われているのかをステータスコードで返す。
        - メールサーバ側ではデーモンプロセスが動いている。そのデーモンプロセスとメールソフトがやりとりしている。
        - メールヘッダーにはどのメールサーバを経由してメールが届けられたのかという情報が記載されている。
- メールヘッダー
    - メールソフトがメールヘッダーを見て、スパムメールかどうかを判定している。スパムメールだった場合、迷惑メールのボックスに格納するようになる。
    - メールヘッダーのRecievedはどのメールサーバを経由してきたのかが分かる。これによって、サーバのIPアドレスが分かるため、なりすましメールかどうかを判断できる。

- メールのFrom欄の偽装
  - Gmailでも設定画面でFrom欄の名前とアドレスを簡単に偽装できてしまう。
  - 他人のメールアドレスを差出人として使用して、宛先に存在しないアドレスを指定したメールを送信することで、エラーメールが本来のメールアドレスの持ち主に来てしまう。例えるなら、ボールを壁に当てて間接的に攻撃するイメージ
  - 対策として、送信者が本物かを確認するためにSPFやDKIMがある。
  - SPFは送信者がDNSにSPFレコードを登録します。そして、受信側は受け取ったメールのドメイン名をDNSに問い合わせて、IPアドレスを取得します。そして、送信元メールサーバのアドレスがDNSから取得したアドレスと一致視してるかをチェックすることで、送信者がなりすましをしていないかが分かる。
  - DKIMは送信者がデジタル署名をメールに添付して、そのデジタル署名を受信者側でチェックして、なりすましをしていないかをチェックする仕組み。送信者はまずDNSサーバに公開鍵を登録する。そして、送信前にメールからハッシュ値を生成して、それに対して、秘密鍵でデジタル署名を生成する。その生成したデジタル署名をメールに添付して送る。受信者は受け取ったメールからハッシュ値を生成する。また、受け取ったデジタル署名をDNSに登録された公開鍵で復元する。復元したハッシュ値と生成したハッシュ値が一致するかを確認することで、なりすましをしていないかチェックする。
